<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramadan Schedule Builder for 9-5ers | Smart Calendar Sync</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5f3f 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
        }

        .step.active {
            background: #ffc107;
            transform: scale(1.2);
        }

        .step.completed {
            background: #4caf50;
        }

        .section-title {
            color: #1a472a;
            font-size: 1.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-setup {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #2d5f3f;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: #2d5f3f;
            color: white;
            width: 100%;
            justify-content: center;
        }

        .btn-primary:hover {
            background: #1a472a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 95, 63, 0.3);
        }

        .btn-secondary {
            background: #ffc107;
            color: #333;
        }

        .btn-secondary:hover {
            background: #ffb300;
        }

        .schedule-output {
            display: none;
        }

        .schedule-output.active {
            display: block;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 80px 1fr 120px;
            gap: 1px;
            background: #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .schedule-header {
            background: #1a472a;
            color: white;
            padding: 12px;
            font-weight: bold;
            text-align: center;
        }

        .schedule-row {
            background: white;
            padding: 12px;
            display: contents;
        }

        .schedule-row > div {
            padding: 12px;
            background: white;
        }

        .schedule-row:nth-child(even) > div {
            background: #f9f9f9;
        }

        .time-cell {
            font-weight: bold;
            color: #2d5f3f;
            text-align: center;
        }

        .activity-cell {
            color: #333;
        }

        .icon-cell {
            text-align: center;
            font-size: 1.2em;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .export-section {
            background: #f0f9f4;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .export-section h3 {
            color: #1a472a;
            margin-bottom: 15px;
        }

        .tip-box {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .tip-box strong {
            color: #1a472a;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .quick-setup {
                grid-template-columns: 1fr;
            }

            .schedule-grid {
                font-size: 0.85em;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            opacity: 0.8;
        }

        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }

            .header,
            .step-indicator,
            .export-section,
            .tip-box,
            .footer,
            button {
                display: none !important;
            }

            .container {
                max-width: 100%;
                margin: 0;
                padding: 0;
            }

            .card {
                box-shadow: none;
                border-radius: 0;
                padding: 20px;
                margin: 0;
                page-break-inside: avoid;
            }

            #setupCard {
                display: none !important;
            }

            .section-title {
                margin-top: 0;
                padding-top: 0;
                page-break-after: avoid;
            }

            .schedule-grid {
                page-break-inside: avoid;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåô Ramadan Schedule Builder</h1>
            <p>For 9-5 Working Professionals</p>
        </div>

        <div class="step-indicator">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3">3</div>
        </div>

        <!-- STEP 1: Quick Setup -->
        <div class="card" id="setupCard">
            <h2 class="section-title">‚ö° Quick Setup (30 seconds)</h2>
            
            <div class="quick-setup">
                <div class="input-group">
                    <label>üìÖ When does Ramadan start for you?</label>
                    <input type="date" id="ramadanStart" value="2025-02-18">
                    <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                        Based on moon sighting in your area
                    </small>
                </div>

                <div class="input-group">
                    <label>üïå What time is Fajr?</label>
                    <input type="time" id="fajrTime" value="04:45">
                </div>

                <div class="input-group">
                    <label>üåÖ What time is Maghrib?</label>
                    <input type="time" id="maghribTime" value="19:15">
                </div>

                <div class="input-group">
                    <label>üíº What time do you start work?</label>
                    <input type="time" id="workStart" value="09:00">
                </div>

                <div class="input-group">
                    <label>üè† What time do you leave work?</label>
                    <input type="time" id="workEnd" value="17:00">
                </div>

                <div class="input-group">
                    <label>‚è±Ô∏è How long is your commute? (one way)</label>
                    <input type="time" id="commuteTime" value="00:30">
                </div>

                <div class="input-group">
                    <label>üò¥ Preferred sleep hours per night?</label>
                    <select id="sleepHours">
                        <option value="5">5 hours (tough!)</option>
                        <option value="6" selected>6 hours</option>
                        <option value="7">7 hours</option>
                        <option value="8">8 hours</option>
                    </select>
                </div>
            </div>

            <div class="tip-box">
                <strong>üí° Pro Tip:</strong> Ramadan 2025 likely starts February 18 (could be 17th depending on moon sighting). Adjust the date based on your local announcement!
            </div>

            <button class="btn btn-primary" onclick="generateSchedule()">
                ‚ú® Generate My Perfect Schedule
            </button>
        </div>

        <!-- STEP 2: Your Schedule -->
        <div class="card schedule-output" id="scheduleCard">
            <h2 class="section-title">üìã Your Personalized Ramadan Schedule</h2>
            
            <div id="scheduleDisplay"></div>

            <div class="export-section">
                <h3>üì± Sync with Your Phone</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                    Choose your calendar app - all 30 days will be added automatically with alarms!
                </p>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="addToGoogleCalendar()">
                        üìÖ Add to Google Calendar
                    </button>
                    <button class="btn btn-secondary" onclick="downloadICS()">
                        üçé Add to Apple Calendar (.ics)
                    </button>
                    <button class="btn btn-secondary" onclick="copyScheduleText()">
                        üìã Copy as Text
                    </button>
                    <button class="btn btn-primary" onclick="window.print()">
                        üñ®Ô∏è Print One-Page
                    </button>
                </div>
            </div>

            <div class="tip-box">
                <strong>‚úÖ How to Sync:</strong> 
                <br><br>
                <strong>Google Calendar Users:</strong> Click "Add to Google Calendar" ‚Üí It opens in browser ‚Üí Click "Save" ‚Üí Repeats for 30 days automatically!
                <br><br>
                <strong>iPhone/Apple Users:</strong> Click "Add to Apple Calendar" ‚Üí Download file ‚Üí Tap file on phone ‚Üí Tap "Add All" ‚Üí Done!
                <br><br>
                <strong>üí° Both methods add alarms that will wake you up/remind you automatically!</strong>
            </div>

            <button class="btn btn-secondary" onclick="resetSchedule()" style="margin-top: 20px;">
                üîÑ Start Over
            </button>
        </div>

        <div class="footer">
            <p>Made with ‚ù§Ô∏è for the Ummah</p>
            <p>¬© iTheLance</p>
        </div>
    </div>

    <script>
        let generatedSchedule = [];

        function generateSchedule() {
            // Get inputs
            const ramadanStart = document.getElementById('ramadanStart').value;
            const fajr = document.getElementById('fajrTime').value;
            const maghrib = document.getElementById('maghribTime').value;
            const workStart = document.getElementById('workStart').value;
            const workEnd = document.getElementById('workEnd').value;
            const commuteInput = document.getElementById('commuteTime').value;
            const sleepHours = parseInt(document.getElementById('sleepHours').value);

            // Convert commute time to minutes
            const [commuteHours, commuteMins] = commuteInput.split(':').map(Number);
            const commute = (commuteHours * 60) + commuteMins;

            // Calculate key times
            const fajrMinutes = timeToMinutes(fajr);
            const maghribMinutes = timeToMinutes(maghrib);
            const workStartMinutes = timeToMinutes(workStart);
            const workEndMinutes = timeToMinutes(workEnd);

            // Store start date for calendar export
            window.ramadanStartDate = ramadanStart;

            // Build smart schedule
            const schedule = [];

            // Suhoor - 30 mins before Fajr
            const suhoorTime = minutesToTime(fajrMinutes - 30);
            schedule.push({ time: suhoorTime, activity: 'Wake up & Suhoor', icon: 'üçΩÔ∏è', alarm: true });
            
            // Fajr
            schedule.push({ time: fajr, activity: 'Fajr Prayer', icon: 'üïå', alarm: true });
            
            // Post-Fajr
            const postFajr = minutesToTime(fajrMinutes + 15);
            schedule.push({ time: postFajr, activity: 'Quran/Dhikr (5-10 mins)', icon: 'üìñ', alarm: false });
            
            // Sleep or work prep
            const bedtime = minutesToTime(1440 - (sleepHours * 60) + fajrMinutes - 30);
            if (workStartMinutes - fajrMinutes - 15 > 90) {
                const backToSleep = minutesToTime(fajrMinutes + 30);
                schedule.push({ time: backToSleep, activity: 'Back to sleep', icon: 'üò¥', alarm: false });
                
                const wakeForWork = minutesToTime(workStartMinutes - commute - 60);
                schedule.push({ time: wakeForWork, activity: 'Wake & get ready', icon: '‚òÄÔ∏è', alarm: true });
            }
            
            // Leave for work
            if (commute > 0) {
                const leaveTime = minutesToTime(workStartMinutes - commute);
                schedule.push({ time: leaveTime, activity: 'Leave for work', icon: 'üöó', alarm: true });
            }
            
            // Dhuhr (assume 12:30pm)
            schedule.push({ time: '12:30', activity: 'Dhuhr Prayer (lunch break)', icon: 'üïå', alarm: true });
            
            // Asr (assume 3:30pm)
            schedule.push({ time: '15:30', activity: 'Asr Prayer (quick break)', icon: 'üïå', alarm: true });
            
            // Leave work
            schedule.push({ time: workEnd, activity: 'Leave work', icon: 'üèÉ', alarm: false });
            
            // Home arrival
            const arriveHome = minutesToTime(workEndMinutes + commute);
            schedule.push({ time: arriveHome, activity: 'Arrive home', icon: 'üè†', alarm: false });
            
            // Power nap before iftar
            const napTime = minutesToTime(maghribMinutes - 60);
            schedule.push({ time: napTime, activity: 'Power nap (optional 20-30min)', icon: 'üò¥', alarm: false });
            
            // Iftar prep
            const iftarPrep = minutesToTime(maghribMinutes - 20);
            schedule.push({ time: iftarPrep, activity: 'Iftar prep', icon: 'üç≥', alarm: true });
            
            // Maghrib & Iftar
            schedule.push({ time: maghrib, activity: 'Maghrib Prayer & Iftar', icon: 'üåô', alarm: true });
            
            // Dinner
            const dinner = minutesToTime(maghribMinutes + 30);
            schedule.push({ time: dinner, activity: 'Dinner (eat slowly)', icon: 'üçΩÔ∏è', alarm: false });
            
            // Isha & Taraweeh
            const isha = minutesToTime(maghribMinutes + 90);
            schedule.push({ time: isha, activity: 'Isha & Taraweeh', icon: 'üïå', alarm: true });
            
            // Personal time
            const personalTime = minutesToTime(maghribMinutes + 150);
            schedule.push({ time: personalTime, activity: 'Personal/Family time', icon: '‚ù§Ô∏è', alarm: false });
            
            // Night ibadah
            const nightIbadah = minutesToTime(fajrMinutes - 90 + 1440);
            schedule.push({ time: nightIbadah, activity: 'Night Quran/Dua', icon: 'üìø', alarm: false });
            
            // Bedtime
            schedule.push({ time: bedtime, activity: 'Sleep', icon: 'üò¥', alarm: true });

            generatedSchedule = schedule;
            displaySchedule(schedule);
            
            // Update UI
            document.getElementById('setupCard').style.display = 'none';
            document.getElementById('scheduleCard').classList.add('active');
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
        }

        function displaySchedule(schedule) {
            let html = '<div class="schedule-grid">';
            html += '<div class="schedule-header">Time</div>';
            html += '<div class="schedule-header">Activity</div>';
            html += '<div class="schedule-header">Alarm?</div>';
            
            schedule.forEach(item => {
                html += '<div class="schedule-row">';
                html += `<div class="time-cell">${item.time}</div>`;
                html += `<div class="activity-cell">${item.icon} ${item.activity}</div>`;
                html += `<div class="icon-cell">${item.alarm ? 'üîî' : ''}</div>`;
                html += '</div>';
            });
            
            html += '</div>';
            document.getElementById('scheduleDisplay').innerHTML = html;
        }

        function timeToMinutes(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function minutesToTime(minutes) {
            // Handle overflow past midnight
            while (minutes >= 1440) minutes -= 1440;
            while (minutes < 0) minutes += 1440;
            
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;
        }

        function downloadICS() {
            // Get the user's selected start date
            const startDate = new Date(window.ramadanStartDate || '2025-02-18');
            
            let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Ramadan Schedule//iTheLance//EN\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\nX-WR-CALNAME:Ramadan 2025 Schedule\nX-WR-TIMEZONE:UTC\n';
            
            generatedSchedule.forEach((item, index) => {
                if (item.alarm) {
                    const eventDate = new Date(startDate);
                    const [hours, minutes] = item.time.split(':');
                    eventDate.setHours(parseInt(hours), parseInt(minutes), 0);
                    
                    const dtStart = formatDateForICS(eventDate);
                    const dtEnd = formatDateForICS(new Date(eventDate.getTime() + 30 * 60000)); // 30 min duration
                    const summary = item.activity.replace(/üïå|üçΩÔ∏è|üç≥|üåô|üöó|‚òÄÔ∏è/g, '').trim();
                    
                    // Create unique ID for each event
                    const uid = `ramadan-${index}-${Date.now()}@ithelance.com`;
                    
                    icsContent += 'BEGIN:VEVENT\n';
                    icsContent += `UID:${uid}\n`;
                    icsContent += `DTSTART:${dtStart}\n`;
                    icsContent += `DTEND:${dtEnd}\n`;
                    icsContent += `RRULE:FREQ=DAILY;COUNT=30\n`;
                    icsContent += `SUMMARY:${summary}\n`;
                    icsContent += `DESCRIPTION:Ramadan ${item.icon} ${summary}\n`;
                    icsContent += `STATUS:CONFIRMED\n`;
                    icsContent += `BEGIN:VALARM\n`;
                    icsContent += `TRIGGER:-PT5M\n`;
                    icsContent += `ACTION:DISPLAY\n`;
                    icsContent += `DESCRIPTION:Reminder: ${summary}\n`;
                    icsContent += `END:VALARM\n`;
                    icsContent += 'END:VEVENT\n';
                }
            });
            
            icsContent += 'END:VCALENDAR';
            
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ramadan-schedule-2025.ics';
            a.click();
            
            // Show helpful message
            setTimeout(() => {
                alert('‚úÖ Calendar file downloaded!\n\nüì± Next steps:\n\niPhone/iPad:\n‚Ä¢ Tap the downloaded file\n‚Ä¢ It will open in Calendar app\n‚Ä¢ Tap "Add All" ‚Üí Done!\n\nAndroid:\n‚Ä¢ Open the file in Google Calendar\n‚Ä¢ Tap "Import" ‚Üí Done!\n\nDesktop:\n‚Ä¢ Open your calendar app (Google/Outlook)\n‚Ä¢ Import the .ics file\n‚Ä¢ All 30 days will be added with alarms!\n\nüéâ Your phone will now remind you automatically!');
            }, 500);
        }

        function formatDateForICS(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}T${hours}${minutes}00`;
        }

        function addToGoogleCalendar() {
            // Google Calendar can handle multiple events through URL, but we'll add them one by one
            // Better approach: Create a shareable Google Calendar link
            
            const startDate = new Date(window.ramadanStartDate || '2025-02-18');
            
            // We'll add the first alarm event as a sample
            const firstAlarmEvent = generatedSchedule.find(item => item.alarm);
            
            if (!firstAlarmEvent) {
                alert('No alarm events found!');
                return;
            }
            
            const [hours, minutes] = firstAlarmEvent.time.split(':');
            const eventDate = new Date(startDate);
            eventDate.setHours(parseInt(hours), parseInt(minutes), 0);
            
            // Format dates for Google Calendar
            const formatGoogleDate = (date) => {
                return date.toISOString().replace(/-|:|\.\d\d\d/g, '');
            };
            
            const eventStart = formatGoogleDate(eventDate);
            const eventEnd = formatGoogleDate(new Date(eventDate.getTime() + 30 * 60000));
            
            const summary = encodeURIComponent(firstAlarmEvent.activity.replace(/üïå|üçΩÔ∏è|üç≥|üåô|üöó|‚òÄÔ∏è/g, '').trim());
            const details = encodeURIComponent(`Ramadan 2025 Schedule\n\nThis is one of your daily Ramadan reminders. All events repeat for 30 days.\n\nFull Schedule:\n${generatedSchedule.map(item => `${item.time} - ${item.activity}`).join('\n')}`);
            
            // Create Google Calendar URL with recurrence
            const recurrence = encodeURIComponent('RRULE:FREQ=DAILY;COUNT=30');
            
            const googleCalUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${summary}&dates=${eventStart}/${eventEnd}&details=${details}&recur=${recurrence}&ctz=UTC`;
            
            // Open in new window
            window.open(googleCalUrl, '_blank');
            
            // Show instructions for adding all events
            setTimeout(() => {
                if (confirm('‚úÖ Google Calendar opened!\n\nThis added ONE sample event (with 30-day repeat).\n\nTo add ALL your alarms automatically:\n‚Ä¢ Click "Download .ics" button instead\n‚Ä¢ Open the file in Google Calendar\n‚Ä¢ All events will import at once\n\nWould you like to download the full calendar file now?')) {
                    downloadICS();
                }
            }, 1000);
        }

        function exportToGoogleCalendar() {
            alert('üìÖ To add to Google Calendar:\n\n1. Download the .ics file using the button below\n2. Go to Google Calendar on desktop\n3. Click the "+" next to "Other calendars"\n4. Select "Import"\n5. Upload the .ics file\n\nAll 30 days will be added automatically!');
        }

        function copyScheduleText() {
            let text = 'üåô MY RAMADAN SCHEDULE\n\n';
            generatedSchedule.forEach(item => {
                text += `${item.time} - ${item.activity} ${item.alarm ? 'üîî' : ''}\n`;
            });
            
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Schedule copied! Paste it anywhere you need.');
            });
        }

        function resetSchedule() {
            document.getElementById('setupCard').style.display = 'block';
            document.getElementById('scheduleCard').classList.remove('active');
            document.getElementById('step1').classList.add('active');
            document.getElementById('step1').classList.remove('completed');
            document.getElementById('step2').classList.remove('active');
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
